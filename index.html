<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kertas Kerja Penerimaan 2025</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #1e1e1e;
  color: #ddd;
}
h2, h4 { text-align: center; margin: 8px 0; }
h4 { font-weight: normal; color: #bbb; }

.sticky-header {
  position: sticky;
  top: 0;
  background: #252525;
  padding: 10px;
  border-bottom: 2px solid #444;
  z-index: 100;
}
.summary {
  display: flex;
  gap: 12px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
.card {
  flex: 1;
  background: #2e2e2e;
  padding: 12px;
  border-radius: 10px;
  min-width: 220px;
  box-shadow: 0 2px 6px rgba(0,0,0,.4);
}
.card h3 { margin: 0; color: #ffcc00; font-size: 15px; }
.card p { margin: 6px 0 0; font-size: 20px; font-weight: bold; }
.card small { display:block; margin-top:4px; color:#aaa; }

.card.target { border:1px solid #3b82f6; }
.card.realisasi { border:1px solid #22c55e; }
.card.persen { border:1px solid #f59e0b; text-align:center; }

.filter-bar {
  display: flex;
  gap: 8px;
  justify-content: center;
}
input, button {
  padding: 8px;
  border-radius: 5px;
  border: 1px solid #666;
  background: #2a2a2a;
  color: #eee;
}
button { cursor: pointer; }

table {
  width: 100%;
  border-collapse: collapse;
  background: #2a2a2a;
}
th, td {
  border: 1px solid #444;
  padding: 6px;
  text-align: center;
}
th {
  background: #333;
  color: #ffcc00;
  position: sticky;
  top: 0;
}
tfoot td {
  background: #333;
  color: #ffcc00;
  font-weight: bold;
  position: sticky;
  bottom: 0;
}
</style>
</head>

<body>

<h2>Kertas Kerja Penerimaan</h2>
<h4>PERIODE 2025</h4>

<div class="sticky-header">
  <div class="summary">
    <div class="card"><h3>Total 2024</h3>
      <p id="summary2024">0</p></div>

    <div class="card"><h3>Total 2025</h3>
      <p id="summary2025">0</p></div>

    <!-- TOTAL -->
    <div class="card">
      <h3>Total</h3>
      <p id="summaryAll">0</p>
      <small id="totalDateNote">Total keseluruhan</small>
    </div>
      
    <!-- TARGET -->
    <div class="card target">
      <h3>Target Tahun 2025</h3>
      <p id="targetMonth">680.000.000</p>
      <small>Target</small>
    </div>

    <!-- REALISASI -->
    <div class="card realisasi">
      <h3 id="runMonthTitle">Realisasi</h3>
      <p id="runMonth">0</p>
      <small id="runMonthNote"></small>
    </div>

    <!-- PERSENTASE -->
    <div class="card persen">
      <h3>Persentase</h3>
      <p id="percentAch">0%</p>
      <small>Target vs Realisasi</small>
    </div>
  </div>

  <div class="filter-bar">
    <input type="text" id="searchInput" placeholder="Cari data..." oninput="loadData()">
    <input type="date" id="dateFilter" onchange="loadData()">
    <button onclick="resetFilter()">Reset</button>
  </div>
</div>

<table>
<thead>
<tr>
  <th>No</th>
  <th>Tanggal</th>
  <th>No Ref IBB</th>
  <th>STS</th>
  <th>Nama</th>
  <th>Unit</th>
  <th>Periode 2024</th>
  <th>Jumlah 2024</th>
  <th>Periode 2025</th>
  <th>Jumlah 2025</th>
  <th>Total</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
<tfoot>
<tr>
  <td colspan="7">TOTAL</td>
  <td id="total2024">0</td>
  <td></td>
  <td id="total2025">0</td>
  <td id="totalAll">0</td>
</tr>
</tfoot>
</table>

<script>
const TARGET_BULAN = 680000000;

/* ===== UTIL ===== */
const bulanIndo = ['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];

function formatTanggalIndo(ddmmyyyy) {
  const [d,m,y] = ddmmyyyy.split('/');
  return `${parseInt(d)} ${bulanIndo[m-1]} ${y}`;
}
function normalizeDate(ddmmyyyy) {
  const [d,m,y] = ddmmyyyy.split('/');
  return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
}
function parseCSVLine(line) {
  return line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/)
             .map(v => v.replace(/^"|"$/g,'').trim());
}

async function loadCSV() {
  const res = await fetch(
    'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9DH8dQDetO_aqJl_orPBZ-7R0FepT4Y_XKqVSxpvweCjF15deQmmfuw-Iz_ht1SrjgKBa3WzT0AsQ/pub?gid=0&single=true&output=csv',
    { cache: 'no-store' }
  );
  return await res.text();
}

async function loadData() {
  const csv = await loadCSV();
  const rows = csv.trim().split('\n').slice(1);

  tbody.innerHTML = '';

  let t24=0, t25=0, tAll=0, tMonth=0, no=1;

  const search = searchInput.value.toLowerCase();
  const filterDate = dateFilter.value;

  const today = new Date();
  const todayMonth = today.toISOString().slice(0,7);

  runMonthTitle.textContent =
    'Realisasi (' + bulanIndo[today.getMonth()] + ' ' + today.getFullYear() + ')';

  runMonthNote.textContent =
    'Realtime per hari ini: ' + today.getDate() + ' ' + bulanIndo[today.getMonth()] + ' ' + today.getFullYear();

  rows.forEach(r=>{
    if(!r.trim()) return;
    const p = parseCSVLine(r);

    const sheetDate = p[0];
    const normalized = normalizeDate(sheetDate);
    const rowDate = new Date(normalized);

    const j24 = parseInt(p[6]) || 0;
    const j25 = parseInt(p[8]) || 0;
    const rowTotal = j24 + j25;

    if (normalized.slice(0,7) === todayMonth && rowDate <= today) {
      tMonth += rowTotal;
    }

    if (filterDate && normalized !== filterDate) return;
    if (search && !p.join(' ').toLowerCase().includes(search)) return;

    t24+=j24; t25+=j25; tAll+=rowTotal;

    tbody.innerHTML += `
      <tr>
        <td>${no++}</td>
        <td>${formatTanggalIndo(sheetDate)}</td>
        <td>${p[1]}</td>
        <td>${p[2]}</td>
        <td>${p[3]}</td>
        <td>${p[4]}</td>
        <td>${p[5]}</td>
        <td>${j24.toLocaleString()}</td>
        <td>${p[7]}</td>
        <td>${j25.toLocaleString()}</td>
        <td>${rowTotal.toLocaleString()}</td>
      </tr>`;
  });

  summary2024.textContent = total2024.textContent = t24.toLocaleString();
  summary2025.textContent = total2025.textContent = t25.toLocaleString();
  summaryAll.textContent  = totalAll.textContent  = tAll.toLocaleString();

  runMonth.textContent = tMonth.toLocaleString();
  targetMonth.textContent = TARGET_BULAN.toLocaleString();

  const persen = TARGET_BULAN ? (tMonth / TARGET_BULAN * 100) : 0;
  percentAch.textContent = persen.toFixed(2) + ' %';

  // === TEKS KECIL TOTAL PER TANGGAL ===
  if (filterDate) {
    const d = new Date(filterDate);
    const tgl = d.getDate() + ' ' + bulanIndo[d.getMonth()] + ' ' + d.getFullYear();
    totalDateNote.textContent = 'Total per tanggal: ' + tgl;
  } else {
    totalDateNote.textContent = 'Total keseluruhan';
  }
}

function resetFilter(){
  searchInput.value='';
  dateFilter.value='';
  loadData();
}

window.onload = loadData;
</script>

</body>
</html>
