<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kertas Kerja Penerimaan 2025</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #1e1e1e;
  color: #ddd;
}
h2, h4 { text-align: center; margin: 8px 0; }
h4 { font-weight: normal; color: #bbb; }

.sticky-header {
  background: #252525;
  padding: 10px;
  border-bottom: 2px solid #444;
}
.summary {
  display: flex;
  gap: 12px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
.card {
  flex: 1;
  background: #2e2e2e;
  padding: 12px;
  border-radius: 10px;
  min-width: 220px;
  box-shadow: 0 2px 6px rgba(0,0,0,.4);
}
.card h3 { margin: 0; color: #ffcc00; font-size: 15px; }
.card p { margin: 6px 0 0; font-size: 20px; font-weight: bold; }
.card small { display:block; margin-top:4px; color:#aaa; }

.card.target { border:1px solid #3b82f6; }
.card.realisasi { border:1px solid #22c55e; }
.card.persen { border:1px solid #f59e0b; text-align:center; }

.public-note {
  text-align:center;
  margin:15px;
  color:#aaa;
  font-size:13px;
}
a { color:#3b82f6; text-decoration:none; }

.card-total {
  display: none;
}

</style>
</head>

<body>

<h2>Kertas Kerja Penerimaan</h2>
<h4>PERIODE 2025</h4>

<div class="sticky-header">
  <div class="summary">
    <div class="card">
      <h3>Total 2024</h3>
      <p id="summary2024">0</p>
      <small>Penerimaan Piutang 2024</small>
    </div>

    <div class="card">
      <h3>Total 2025</h3>
      <p id="summary2025">0</p>
      <small>Penerimaan 2025</small>
    </div>

    <div class="card card-total">
      <h3>Total</h3>
      <p id="summaryAll">0</p>
      <small id="totalDateNote">Total keseluruhan</small>
    </div>

    <div class="card target">
      <h3>Target Tahun 2025</h3>
      <p id="targetMonth">680.000.000</p>
      <small>Target</small>
    </div>

    <div class="card realisasi">
      <h3 id="runMonthTitle">Realisasi</h3>
      <p id="runMonth">0</p>
      <small id="runMonthNote"></small>
    </div>

    <div class="card persen">
      <h3>Persentase</h3>
      <p id="percentAch">0%</p>
      <small>Target vs Realisasi</small>
    </div>
  </div>
</div>

<div class="public-note">
  ðŸ”’ Tampilan detail hanya untuk pengelola.  
  <br>ðŸ‘‰ <a href="/detail">Masuk halaman detail</a>
</div>

<script>
const TARGET_BULAN = 680000000;
const bulanIndo = ['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];

async function loadCSV() {
  const API_URL = "https://script.google.com/macros/s/AKfycbwrYJaeNxdQnWHJ5vA5eL8O5XnuaVqBfNtCf2Oe0MlO0j4QZMITWICNWbNGfuNQG4qO1g/exec";
  const API_KEY = "RUSUN2025";

  const params = new URLSearchParams({
    key: API_KEY,
    origin: location.origin,
    ip: "client"
  });

  const res = await fetch(API_URL + "?" + params.toString(), { cache: "no-store" });
  const text = await res.text();
  if (text.startsWith("{")) throw new Error("API ditolak");
  return text;
}

async function loadPublic() {
  const csv = await loadCSV();
  const rows = csv.trim().split('\n').slice(1);

  let t24=0, t25=0, tAll=0, tMonth=0;

  const today = new Date();
  const todayMonth = today.toISOString().slice(0,7);

  rows.forEach(r=>{
    const p = r.split(',');
    const [d,m,y] = p[0].split('/');
    const normalized = `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;

    const j24 = parseInt(p[6])||0;
    const j25 = parseInt(p[8])||0;
    const rowTotal = j24+j25;

    if (normalized.slice(0,7) === todayMonth) {
      tMonth += rowTotal;
    }

    t24+=j24; t25+=j25; tAll+=rowTotal;
  });

  summary2024.textContent = t24.toLocaleString();
  summary2025.textContent = t25.toLocaleString();
  summaryAll.textContent  = tAll.toLocaleString();

  runMonth.textContent = tMonth.toLocaleString();
  targetMonth.textContent = TARGET_BULAN.toLocaleString();

  const persen = TARGET_BULAN ? (tMonth / TARGET_BULAN * 100) : 0;
  percentAch.textContent = persen.toFixed(2) + ' %';

  runMonthTitle.textContent = 'Realisasi ('+bulanIndo[today.getMonth()]+' '+today.getFullYear()+')';
  runMonthNote.textContent  = 'Per hari ini: '+today.getDate()+' '+bulanIndo[today.getMonth()]+' '+today.getFullYear();
}

window.onload = loadPublic;
</script>

</body>
</html>
